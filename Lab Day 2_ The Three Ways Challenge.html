<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab Day 2: The Three Ways Challenge | EXIN DevOps</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Fira+Code:wght@400;500&display=swap');
        
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        code, pre { font-family: 'Fira Code', monospace; }

        .phase-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        .phase-card.active {
            background-color: #1e293b;
            border-left-color: #3b82f6;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .phase-card.completed {
            border-left-color: #22c55e;
            opacity: 0.7;
        }

        .terminal {
            background-color: #000;
            color: #00ff00;
            font-family: 'Fira Code', monospace;
            padding: 1rem;
            border-radius: 0.5rem;
            height: 200px;
            overflow-y: auto;
            font-size: 0.8rem;
            border: 1px solid #333;
        }

        .metric-box {
            background: #1e293b;
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            border: 1px solid #334155;
        }

        .hidden-section { display: none; }
        .visible-section { display: block; animation: fadeIn 0.5s; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .blink { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-slate-900 border-b border-slate-700 p-4 flex justify-between items-center shrink-0">
        <div class="flex items-center gap-3">
            <div class="bg-indigo-600 text-white p-2 rounded-lg"><i class="fas fa-infinity"></i></div>
            <div>
                <h1 class="font-bold text-xl text-white">The Three Ways Challenge</h1>
                <p class="text-xs text-slate-400">EXIN DevOps Professional - Day 2 Lab</p>
            </div>
        </div>
        <div class="flex gap-4 text-sm">
            <div class="metric-box py-1 px-3">
                <div class="text-slate-400 text-xs">Deployment Freq</div>
                <div class="font-bold text-blue-400" id="metric-df">1/mese</div>
            </div>
            <div class="metric-box py-1 px-3">
                <div class="text-slate-400 text-xs">MTTR</div>
                <div class="font-bold text-red-400" id="metric-mttr">48h</div>
            </div>
            <div class="metric-box py-1 px-3">
                <div class="text-slate-400 text-xs">Customer Sat</div>
                <div class="font-bold text-yellow-400" id="metric-csat">2/5</div>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        
        <!-- Sidebar: Mission Control -->
        <aside class="w-80 bg-slate-800 border-r border-slate-700 overflow-y-auto p-4 flex flex-col gap-4">
            <div class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Fasi della Missione</div>
            
            <div id="nav-phase-1" class="phase-card active p-4 rounded bg-slate-700/50 cursor-pointer" onclick="goToPhase(1)">
                <h3 class="font-bold text-blue-400 mb-1">1. The First Way: Flow</h3>
                <p class="text-xs text-slate-300">Il deployment √® manuale e lento. Automatizza la pipeline per accelerare il flusso.</p>
            </div>

            <div id="nav-phase-2" class="phase-card p-4 rounded cursor-pointer" onclick="goToPhase(2)">
                <h3 class="font-bold text-purple-400 mb-1">2. The Second Way: Feedback</h3>
                <p class="text-xs text-slate-300">Incidente in corso! Usa la telemetria per diagnosticare e risolvere senza rollback.</p>
            </div>

            <div id="nav-phase-3" class="phase-card p-4 rounded cursor-pointer" onclick="goToPhase(3)">
                <h3 class="font-bold text-green-400 mb-1">3. The Third Way: Learning</h3>
                <p class="text-xs text-slate-300">Conduci un Blameless Postmortem e inietta resilienza con Chaos Engineering.</p>
            </div>

            <div class="mt-auto bg-slate-900 p-4 rounded border border-slate-700">
                <h4 class="text-xs font-bold text-slate-400 mb-2">CONSOLE LOG</h4>
                <div id="console-log" class="terminal h-32 text-xs">
                    > System initialized...<br>
                    > Waiting for user input...
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 overflow-y-auto p-8 relative bg-slate-900">
            
            <!-- PHASE 1: FLOW -->
            <div id="phase-1" class="visible-section max-w-4xl mx-auto">
                <div class="bg-slate-800 rounded-xl p-8 border border-slate-700 shadow-xl">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <span class="bg-blue-900 text-blue-200 text-xs font-bold px-2 py-1 rounded uppercase">Scenario Attuale</span>
                            <h2 class="text-3xl font-bold text-white mt-2">Il Collo di Bottiglia</h2>
                        </div>
                        <i class="fas fa-stream text-4xl text-slate-600"></i>
                    </div>
                    
                    <p class="text-slate-300 mb-6">
                        Il team di sviluppo ha completato una nuova feature critica ("One-Click Checkout"), ma il processo di rilascio √® bloccato.
                        Attualmente, il deployment richiede:
                        <ul class="list-disc list-inside ml-4 mt-2 text-slate-400">
                            <li>Ticket manuale a Ops (attesa: 2 giorni)</li>
                            <li>Copia manuale dei file FTP (rischio errore umano)</li>
                            <li>Test manuali in produzione (lento e rischioso)</li>
                        </ul>
                    </p>

                    <div class="bg-slate-900 p-6 rounded-lg border border-slate-600 mb-8">
                        <h3 class="font-bold text-white mb-4"><i class="fas fa-tools mr-2"></i>Costruisci la Pipeline CI/CD</h3>
                        <p class="text-sm text-slate-400 mb-4">Trascina (clicca) i componenti nell'ordine corretto per creare una pipeline sicura e veloce.</p>
                        
                        <div class="grid grid-cols-5 gap-2 mb-4" id="pipeline-options">
                            <button onclick="addToPipeline('Deploy Prod')" class="bg-red-900/50 border border-red-700 hover:bg-red-800 text-white p-2 rounded text-xs">Deploy Prod</button>
                            <button onclick="addToPipeline('Unit Test')" class="bg-blue-900/50 border border-blue-700 hover:bg-blue-800 text-white p-2 rounded text-xs">Unit Test</button>
                            <button onclick="addToPipeline('Build')" class="bg-yellow-900/50 border border-yellow-700 hover:bg-yellow-800 text-white p-2 rounded text-xs">Build</button>
                            <button onclick="addToPipeline('Commit')" class="bg-green-900/50 border border-green-700 hover:bg-green-800 text-white p-2 rounded text-xs">Commit</button>
                            <button onclick="addToPipeline('Staging Deploy')" class="bg-purple-900/50 border border-purple-700 hover:bg-purple-800 text-white p-2 rounded text-xs">Staging Deploy</button>
                        </div>

                        <div class="bg-black p-4 rounded border border-slate-500 min-h-[60px] flex items-center gap-2 overflow-x-auto" id="pipeline-dropzone">
                            <span class="text-slate-600 text-xs italic" id="dropzone-placeholder">La tua pipeline apparir√† qui...</span>
                        </div>
                        
                        <div class="flex justify-between mt-4">
                            <button onclick="resetPipeline()" class="text-slate-400 text-sm hover:text-white">Reset</button>
                            <button onclick="validatePhase1()" class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-2 rounded font-bold">Esegui Pipeline <i class="fas fa-play ml-2"></i></button>
                        </div>
                        <p id="p1-error" class="text-red-400 text-sm mt-2 hidden"></p>
                    </div>
                </div>
            </div>

            <!-- PHASE 2: FEEDBACK -->
            <div id="phase-2" class="hidden-section max-w-4xl mx-auto">
                <div class="bg-slate-800 rounded-xl p-8 border border-slate-700 shadow-xl">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <span class="bg-purple-900 text-purple-200 text-xs font-bold px-2 py-1 rounded uppercase">Incidente Live</span>
                            <h2 class="text-3xl font-bold text-white mt-2">Allarme in Produzione! üö®</h2>
                        </div>
                        <i class="fas fa-heart-broken text-4xl text-red-500 blink"></i>
                    </div>

                    <p class="text-slate-300 mb-6">
                        La pipeline ha funzionato, ma 10 minuti dopo il rilascio, gli utenti segnalano errori nel checkout.
                        Il management preme per un <strong>Rollback</strong> immediato, ma tu sai che il "Fix Forward" √® meglio se identifichi la causa rapidamente.
                    </p>

                    <div class="grid grid-cols-2 gap-6 mb-8">
                        <!-- Telemetry Dashboard -->
                        <div class="bg-slate-900 p-4 rounded border border-slate-600">
                            <h3 class="font-bold text-slate-400 text-xs uppercase mb-2">Telemetry Dashboard</h3>
                            <canvas id="errorChart" height="150"></canvas>
                            <div class="mt-2 text-xs text-slate-400">
                                <span class="text-red-400 font-bold">Error Rate: 15%</span> (Soglia critica: 5%)
                            </div>
                        </div>

                        <!-- Logs -->
                        <div class="bg-black p-4 rounded border border-slate-600 font-mono text-xs text-slate-300 overflow-y-auto h-48">
                            <div class="text-slate-500">--- Application Logs (Tail -f) ---</div>
                            <div class="text-green-400">INFO: User 1024 login success</div>
                            <div class="text-red-500">ERROR: PaymentGateway timeout (5000ms)</div>
                            <div class="text-red-500">ERROR: Transaction aborted for Order #992</div>
                            <div class="text-green-400">INFO: User 1025 view product</div>
                            <div class="text-red-500">ERROR: PaymentGateway timeout (5000ms)</div>
                            <div class="text-yellow-500">WARN: Retrying connection to StripeAPI...</div>
                        </div>
                    </div>

                    <div class="bg-slate-700/50 p-6 rounded-lg border border-slate-600">
                        <h3 class="font-bold text-white mb-4">Diagnosi e Azione</h3>
                        <p class="text-sm text-slate-300 mb-4">Analizza i log sopra. Qual √® la causa e qual √® la fix corretta (Fix Forward)?</p>
                        
                        <div class="space-y-3">
                            <label class="flex items-center p-3 bg-slate-800 rounded border border-slate-600 cursor-pointer hover:border-blue-500">
                                <input type="radio" name="incident-action" value="rollback" class="mr-3">
                                <div>
                                    <div class="font-bold text-white">Esegui Rollback Completo</div>
                                    <div class="text-xs text-slate-400">Torna alla versione precedente. Sicuro, ma perdi la feature.</div>
                                </div>
                            </label>
                            <label class="flex items-center p-3 bg-slate-800 rounded border border-slate-600 cursor-pointer hover:border-blue-500">
                                <input type="radio" name="incident-action" value="db" class="mr-3">
                                <div>
                                    <div class="font-bold text-white">Riavvia il Database</div>
                                    <div class="text-xs text-slate-400">Speriamo che sia un problema temporaneo di connessione.</div>
                                </div>
                            </label>
                            <label class="flex items-center p-3 bg-slate-800 rounded border border-slate-600 cursor-pointer hover:border-blue-500">
                                <input type="radio" name="incident-action" value="fix" class="mr-3">
                                <div>
                                    <div class="font-bold text-white">Aumenta Timeout & Circuit Breaker (Fix Forward)</div>
                                    <div class="text-xs text-slate-400">I log indicano timeout. Configura un timeout pi√π alto e attiva il circuit breaker.</div>
                                </div>
                            </label>
                        </div>

                        <div class="mt-6 text-right">
                            <button onclick="validatePhase2()" class="bg-purple-600 hover:bg-purple-500 text-white px-6 py-2 rounded font-bold">Applica Soluzione</button>
                        </div>
                        <p id="p2-error" class="text-red-400 text-sm mt-2 hidden text-right"></p>
                    </div>
                </div>
            </div>

            <!-- PHASE 3: LEARNING -->
            <div id="phase-3" class="hidden-section max-w-4xl mx-auto">
                <div class="bg-slate-800 rounded-xl p-8 border border-slate-700 shadow-xl">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <span class="bg-green-900 text-green-200 text-xs font-bold px-2 py-1 rounded uppercase">Post-Incident Learning</span>
                            <h2 class="text-3xl font-bold text-white mt-2">Blameless Postmortem</h2>
                        </div>
                        <i class="fas fa-graduation-cap text-4xl text-slate-600"></i>
                    </div>

                    <p class="text-slate-300 mb-6">
                        L'incidente √® risolto. Ora dobbiamo imparare per evitare che accada di nuovo.
                        Compila il report <strong>Blameless</strong>. Ricorda: non puntare il dito contro le persone, cerca cause sistemiche.
                    </p>

                    <div class="grid md:grid-cols-2 gap-8">
                        <!-- Postmortem Form -->
                        <div class="space-y-4">
                            <div>
                                <label class="block text-xs font-bold text-slate-400 mb-1">Root Cause (Sistemica)</label>
                                <select id="pm-root" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-sm text-white">
                                    <option value="0">Seleziona...</option>
                                    <option value="wrong">Lo sviluppatore Mario non ha testato il timeout</option>
                                    <option value="correct">Mancanza di test di carico (NFR) nella pipeline CI/CD</option>
                                    <option value="wrong">Il network provider ha fallito</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-400 mb-1">Action Item (Prevenzione)</label>
                                <select id="pm-action" class="w-full bg-slate-900 border border-slate-600 rounded p-2 text-sm text-white">
                                    <option value="0">Seleziona...</option>
                                    <option value="wrong">Licenziare Mario</option>
                                    <option value="wrong">Aggiungere un'approvazione manuale in pi√π</option>
                                    <option value="correct">Aggiungere Chaos Engineering (Latency Injection) in Staging</option>
                                </select>
                            </div>
                        </div>

                        <!-- Chaos Engineering Simulation -->
                        <div class="bg-slate-900 p-4 rounded border border-slate-600">
                            <h3 class="font-bold text-white text-sm mb-2"><i class="fas fa-flask mr-2"></i>Chaos Experiment</h3>
                            <p class="text-xs text-slate-400 mb-4">Simula l'Action Item scelto. Iniettiamo latenza in Staging per verificare se il sistema regge.</p>
                            
                            <div class="flex items-center justify-between bg-black p-2 rounded mb-2">
                                <span class="text-xs text-green-400">Service Status:</span>
                                <span id="chaos-status" class="text-xs font-bold text-green-400">HEALTHY</span>
                            </div>
                            
                            <button onclick="runChaos()" id="chaos-btn" class="w-full bg-slate-700 hover:bg-slate-600 text-white py-2 rounded text-xs font-bold disabled:opacity-50">
                                <i class="fas fa-random mr-2"></i>Inietta Latenza (Chaos Monkey)
                            </button>
                            <div id="chaos-result" class="mt-2 text-xs text-slate-300 hidden"></div>
                        </div>
                    </div>

                    <div class="mt-8 text-right">
                        <button onclick="validatePhase3()" class="bg-green-600 hover:bg-green-500 text-white px-6 py-2 rounded font-bold">Completa Missione</button>
                    </div>
                    <p id="p3-error" class="text-red-400 text-sm mt-2 hidden text-right"></p>
                </div>
            </div>

            <!-- VICTORY SCREEN -->
            <div id="victory-screen" class="hidden-section max-w-4xl mx-auto text-center pt-10">
                <div class="inline-block p-6 rounded-full bg-green-900/30 mb-6">
                    <i class="fas fa-trophy text-6xl text-yellow-400"></i>
                </div>
                <h2 class="text-4xl font-bold text-white mb-4">Missione Compiuta!</h2>
                <p class="text-xl text-slate-300 mb-8 max-w-2xl mx-auto">
                    Hai applicato con successo i principi DevOps. Hai trasformato un processo fragile in un sistema resiliente e capace di apprendere.
                </p>
                
                <div class="grid grid-cols-3 gap-6 max-w-3xl mx-auto mb-10">
                    <div class="bg-slate-800 p-4 rounded border border-slate-700">
                        <div class="text-slate-400 text-xs uppercase">Deployment Freq</div>
                        <div class="text-2xl font-bold text-green-400">On-Demand</div>
                        <div class="text-xs text-slate-500">Era: 1/mese</div>
                    </div>
                    <div class="bg-slate-800 p-4 rounded border border-slate-700">
                        <div class="text-slate-400 text-xs uppercase">MTTR</div>
                        <div class="text-2xl font-bold text-green-400">10 min</div>
                        <div class="text-xs text-slate-500">Era: 48h</div>
                    </div>
                    <div class="bg-slate-800 p-4 rounded border border-slate-700">
                        <div class="text-slate-400 text-xs uppercase">Reliability</div>
                        <div class="text-2xl font-bold text-green-400">High</div>
                        <div class="text-xs text-slate-500">Grazie a Chaos Eng.</div>
                    </div>
                </div>

                <button onclick="location.reload()" class="text-blue-400 hover:text-blue-300 underline">Ricomincia Lab</button>
            </div>

        </main>
    </div>

    <script>
        // --- LOGIC ---
        let pipeline = [];
        
        function log(msg) {
            const term = document.getElementById('console-log');
            term.innerHTML += `> ${msg}<br>`;
            term.scrollTop = term.scrollHeight;
        }

        function goToPhase(phase) {
            // Simple navigation for dev/debug, usually locked in real lab
            // document.querySelectorAll('.visible-section').forEach(el => el.classList.remove('visible-section'));
            // document.querySelectorAll('.hidden-section').forEach(el => el.classList.add('hidden-section'));
            // document.getElementById(`phase-${phase}`).classList.remove('hidden-section');
            // document.getElementById(`phase-${phase}`).classList.add('visible-section');
        }

        // PHASE 1 LOGIC
        function addToPipeline(item) {
            pipeline.push(item);
            renderPipeline();
        }

        function renderPipeline() {
            const container = document.getElementById('pipeline-dropzone');
            if (pipeline.length === 0) {
                container.innerHTML = '<span class="text-slate-600 text-xs italic" id="dropzone-placeholder">La tua pipeline apparir√† qui...</span>';
                return;
            }
            container.innerHTML = pipeline.map((item, index) => `
                <div class="bg-slate-800 text-white px-3 py-1 rounded text-xs border border-slate-600 flex items-center gap-2 whitespace-nowrap">
                    <span class="font-bold text-slate-500">${index + 1}.</span> ${item}
                </div>
                ${index < pipeline.length - 1 ? '<i class="fas fa-arrow-right text-slate-600 text-xs"></i>' : ''}
            `).join('');
        }

        function resetPipeline() {
            pipeline = [];
            renderPipeline();
            document.getElementById('p1-error').classList.add('hidden');
        }

        function validatePhase1() {
            // Correct Order: Commit -> Build -> Unit Test -> Staging -> Prod
            // Acceptable variations exist, but let's enforce a standard CI/CD flow
            const correct = ['Commit', 'Build', 'Unit Test', 'Staging Deploy', 'Deploy Prod'];
            
            let isValid = pipeline.length === correct.length && pipeline.every((val, index) => val === correct[index]);

            if (isValid) {
                log("Pipeline executed successfully. Build passed. Tests passed. Deploying...");
                document.getElementById('metric-df').innerText = "Daily";
                document.getElementById('metric-df').classList.replace('text-blue-400', 'text-green-400');
                
                // Transition
                document.getElementById('nav-phase-1').classList.add('completed');
                document.getElementById('nav-phase-1').classList.remove('active');
                document.getElementById('nav-phase-2').classList.add('active');
                
                setTimeout(() => {
                    document.getElementById('phase-1').classList.remove('visible-section');
                    document.getElementById('phase-1').classList.add('hidden-section');
                    document.getElementById('phase-2').classList.remove('hidden-section');
                    document.getElementById('phase-2').classList.add('visible-section');
                    initChart();
                }, 1500);
            } else {
                document.getElementById('p1-error').innerText = "Ordine errato. Ricorda: Commit -> Build -> Test -> Staging -> Prod";
                document.getElementById('p1-error').classList.remove('hidden');
                log("Pipeline Failed: Invalid configuration.");
            }
        }

        // PHASE 2 LOGIC
        function initChart() {
            const ctx = document.getElementById('errorChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['10:00', '10:05', '10:10', '10:15', '10:20'],
                    datasets: [{
                        label: 'Error Rate %',
                        data: [0.5, 0.8, 12.5, 15.2, 14.8],
                        borderColor: '#ef4444',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true, max: 20 } }
                }
            });
        }

        function validatePhase2() {
            const choice = document.querySelector('input[name="incident-action"]:checked');
            const errorMsg = document.getElementById('p2-error');
            
            if (!choice) {
                errorMsg.innerText = "Seleziona un'azione.";
                errorMsg.classList.remove('hidden');
                return;
            }

            if (choice.value === 'fix') {
                log("Applying Fix Forward: Updated timeout config & Circuit Breaker...");
                log("Redeploying...");
                log("Error rate dropping to 0.1%... SYSTEM STABLE.");
                
                document.getElementById('metric-mttr').innerText = "15 min";
                document.getElementById('metric-mttr').classList.replace('text-red-400', 'text-green-400');

                // Transition
                document.getElementById('nav-phase-2').classList.add('completed');
                document.getElementById('nav-phase-2').classList.remove('active');
                document.getElementById('nav-phase-3').classList.add('active');

                setTimeout(() => {
                    document.getElementById('phase-2').classList.remove('visible-section');
                    document.getElementById('phase-2').classList.add('hidden-section');
                    document.getElementById('phase-3').classList.remove('hidden-section');
                    document.getElementById('phase-3').classList.add('visible-section');
                }, 1500);

            } else if (choice.value === 'rollback') {
                errorMsg.innerText = "Il Rollback risolve l'incidente ma perdi valore business. I log erano chiari (timeout). Riprova con un approccio DevOps pi√π maturo.";
                errorMsg.classList.remove('hidden');
            } else {
                errorMsg.innerText = "Riavviare il DB non risolve un problema di configurazione dell'applicazione. Riprova.";
                errorMsg.classList.remove('hidden');
            }
        }

        // PHASE 3 LOGIC
        let chaosRun = false;

        function runChaos() {
            const btn = document.getElementById('chaos-btn');
            const res = document.getElementById('chaos-result');
            const status = document.getElementById('chaos-status');
            
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Injecting Latency...';
            
            setTimeout(() => {
                status.innerText = "DEGRADED";
                status.classList.replace('text-green-400', 'text-yellow-400');
                log("Chaos Monkey: Added 5000ms latency to Payment Service.");
            }, 1000);

            setTimeout(() => {
                log("System Response: Circuit Breaker OPEN. Fallback triggered.");
                res.innerHTML = "<span class='text-green-400'>SUCCESS:</span> Il sistema ha gestito la latenza attivando il Circuit Breaker. Nessun errore 500 per l'utente.";
                res.classList.remove('hidden');
                status.innerText = "HEALTHY (Fallback)";
                status.classList.replace('text-yellow-400', 'text-green-400');
                btn.innerHTML = '<i class="fas fa-check mr-2"></i>Esperimento Completato';
                chaosRun = true;
            }, 3000);
        }

        function validatePhase3() {
            const root = document.getElementById('pm-root').value;
            const action = document.getElementById('pm-action').value;
            const errorMsg = document.getElementById('p3-error');

            if (root === 'correct' && action === 'correct' && chaosRun) {
                document.getElementById('metric-csat').innerText = "5/5";
                document.getElementById('metric-csat').classList.replace('text-yellow-400', 'text-green-400');
                
                document.getElementById('phase-3').classList.remove('visible-section');
                document.getElementById('phase-3').classList.add('hidden-section');
                document.getElementById('victory-screen').classList.remove('hidden-section');
                document.getElementById('victory-screen').classList.add('visible-section');
                
                document.getElementById('nav-phase-3').classList.add('completed');
            } else {
                if (!chaosRun) {
                    errorMsg.innerText = "Devi eseguire l'esperimento di Chaos Engineering prima di concludere.";
                } else {
                    errorMsg.innerText = "Le risposte al Postmortem non sono corrette. Cerca cause sistemiche, non umane.";
                }
                errorMsg.classList.remove('hidden');
            }
        }

    </script>
</body>
</html>